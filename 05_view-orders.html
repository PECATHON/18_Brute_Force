<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>View Orders — Foody</title>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

  :root{
    --glass-bg: rgba(255,255,255,0.08);
    --accent-pink: #ff2b6e;
    --accent-cyan: #29d9ff;
    --glass-border: rgba(255,255,255,0.14);
  }

  *{ box-sizing: border-box; margin:0; padding:0; font-family:"Poppins",sans-serif; }

  body{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background-color:#0b0b11;
    color:#fff;
    position:relative;
    overflow:auto;
  }

  .foody-bg{
    position:fixed;
    inset:0;
    background-image:
      linear-gradient(170deg, rgba(6,6,8,0.62), rgba(6,6,8,0.62)),
      url("https://img.freepik.com/free-photo/top-view-circular-food-frame_23-2148723455.jpg");
    background-size:cover;
    background-position:center;
    filter:saturate(1.05) contrast(1.02);
    animation: slowFloat 18s ease-in-out infinite;
    z-index:0;
  }

  @keyframes slowFloat{
    0%{ transform:scale(1) translateY(0); }
    50%{ transform:scale(1.02) translateY(-10px); }
    100%{ transform:scale(1) translateY(0); }
  }

  .login-wrap{
    width:800px;
    max-width:95%;
    padding:34px;
    margin-top:30px;
    border-radius:18px;
    background:var(--glass-bg);
    backdrop-filter:blur(12px) saturate(120%);
    border:1px solid var(--glass-border);
    box-shadow:0 10px 40px rgba(2,6,23,0.6);
    position:relative;
    z-index:2;
    transition:.25s;
  }

  .header{text-align:center;margin-bottom:24px;}
  .header h1{ font-size:22px;font-weight:600;margin-bottom:6px; }
  .header p{ font-size:13px;opacity:0.85; }

  .orders-list{
    margin-top:20px;
    padding:10px;
    border-radius:12px;
    background:rgba(255,255,255,0.05);
    max-height:500px;
    overflow-y:auto;
  }

  .order-card{
    padding:15px;
    border-bottom:1px solid rgba(255,255,255,0.1);
    margin-bottom:10px;
  }
  .order-card:last-child{ border-bottom:none; }

  .order-header{
    font-weight:600;
    margin-bottom:10px;
  }

  .order-item{
    margin-left:10px;
    font-size:14px;
  }

  .order-total{
    font-weight:600;
    color:var(--accent-cyan);
    margin-top:10px;
  }

  .btn{
    padding:8px 16px;
    border-radius:8px;
    font-weight:600;
    cursor:pointer;
    border:none;
    font-size:14px;
    margin-top:10px;
  }
  .complete-btn{ background:var(--accent-cyan); color:#000; }
  .back-btn{ background:rgba(255,255,255,0.1); color:#fff; }

  .msg{ margin-top:20px; text-align:center; font-size:13px; height:20px; }
  .msg.success{ color:#9fffcb; }
  .msg.error{ color:#ff8b8b; }
</style>
</head>
<body>

<div class="foody-bg"></div>

<div class="login-wrap">
  <div class="header">
    <h1>View Orders</h1>
    <p>Check orders placed by students for your items.</p>
  </div>

  <div id="ordersList" class="orders-list">
    <!-- Orders will be loaded here -->
  </div>

  <div id="noOrdersMsg" class="msg" style="display:none;">No orders yet.</div>

  <button class="btn back-btn" onclick="window.location.href='vendor-dashboard.html'">Back to Dashboard</button>

  <div id="message" class="msg"></div>
</div>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBzICC4WWJbI6znrLfafWvg6vwdR_joRlI",
    authDomain: "bruteforce96-433ed.firebaseapp.com",
    projectId: "bruteforce96-433ed",
    storageBucket: "bruteforce96-433ed.appspot.com",
    messagingSenderId: "87702972088",
    appId: "1:87702972088:web:2b5f391e7abb674d24764d",
    measurementId: "G-3PCXV2KQFE"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();

  let currentVendorId = '';

  // Ensure vendor is logged in
  auth.onAuthStateChanged(user => {
    if(user){
      currentVendorId = user.uid;
      loadOrders();
    } else {
      alert('Please log in as vendor.');
      window.location.href = 'login.html';
    }
  });

  function loadOrders(){
    db.ref('orders').on('value', snapshot => {
      const ordersList = document.getElementById('ordersList');
      const noOrdersMsg = document.getElementById('noOrdersMsg');
      ordersList.innerHTML = '';

      let hasOrders = false;
      snapshot.forEach(orderSnap => {
        const order = orderSnap.val();
        if(order.ordersByVendor && order.ordersByVendor[currentVendorId]){
          hasOrders = true;
          const vendorOrder = order.ordersByVendor[currentVendorId];
          const orderCard = document.createElement('div');
          orderCard.className = 'order-card';
          orderCard.innerHTML = `
            <div class="order-header">Order ID: ${order.orderId} | ${new Date(order.timestamp).toLocaleString()}</div>
            ${vendorOrder.items.map(item => `
              <div class="order-item">${item.name} x${item.quantity} - ₹${item.price * item.quantity}</div>
            `).join('')}
            <div class="order-total">Total: ₹${vendorOrder.items.reduce((sum, item) => sum + item.price * item.quantity, 0)}</div>
            <button class="btn complete-btn" onclick="markComplete('${order.orderId}')">Mark as Completed</button>
          `;
          ordersList.appendChild(orderCard);
        }
      });

      if(!hasOrders){
        noOrdersMsg.style.display = 'block';
      } else {
        noOrdersMsg.style.display = 'none';
      }
    });
  }

  function markComplete(orderId){
    // Optionally, update the order status in Firebase
    db.ref(`orders/${orderId}`).update({ status: 'completed' }).then(() => {
      document.getElementById('message').textContent = "✔ Order marked as completed!";
      document.getElementById('message').className = "msg success";
    }).catch(error => {
      console.error('Error updating order:', error);
      document.getElementById('message').textContent = "⚠ Error updating order.";
      document.getElementById('message').className = "msg error";
    });
  }
</script>

</body>
</html>